<!DOCTYPE html>
<html>
<head>
<title>NORT Tutorial</title>  
<script src="js/csi.js"></script>  
<script src="js/autotoc.js"></script> 
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
    <script>include("header.html")</script>  
    <section>
        <div class="container">
            <h1>Component advanced use</h1>
            <div id="toc" style="width: 20%; float: left;"><h2>Content</h2></div> 
            <div style="width: 75%; float: right;" id="contents">

                <h2>Dynamic components</h2>
                <p>In the previous section we learned how to create elements and components, but the component we created is quite static</p>


                <pre><code class="javascript">
    // declare our component
    class myGeneratedList extends nort.Component {
        constructor( attributes, items ) {
            super(attributes)
            this.items = items
        }

        render() {
            let list=[]
            // Generate an array of LI elements.
            for ( let item of this.items ) {
                list.push( $li(this.properties, item ))
            }
            // Return a UL element containing the collection of LI element.
            return $ul({}, list)                             
        }
    }

                </code></pre>

                <p>Now let's say we want to make our component more dynamic, by adding a text field and a button below the list,
                    so that we can add items to the list. Something like <a href="demo/tutorial4" target="demo">this</a>. 
                </p>
                <p>We would need to add tou our component:</p>
                <ul>
                    <li>A textbox</li>
                    <li>A button</li>
                    <li>The code to add the new item list</li>
                </ul>
                <p>To add an item to the list, we would just add a method to our component:</p>
                <pre><code class="javascript">
    // Modify the component's data and refresh it.
    addItem(item) {
        this.items.push(item)
        this.refresh()
    }                    
                </code></pre>
                <p>Note the builtin method <b>refresh</b> we use to refresh the DOM after changing the component state.</p>
                <p>We will then need to add the textbox and the button to the component. We do it in its constructor:</p>                                
                <pre><code class="javascript">
    // Add a textbox and a button
    this.textbox = $input({ type: "text" })
    this.button  = $input({ type: "button", value:"Add to list"  })
    
    // Add a callback to the button
    this.button.onclick = function() {
        // Note we use "me" and not "this"
        me.addItem( me.textbox.value)
    }
                </code></pre>
                <p>You will also tell your component how to display the new fields by changing its <b>render()</b> method</p>
                <pre><code class="javascript">
    // Return a DIV element 
    return $div({}, 
        $ul({}, list),
        this.textbox, this.button )   // We add the fields at the bottom, after the list                 
                </code></pre>
                <p>You're done. Now the component can accept new data and refresh itsef in the page.
                    The complete code of our new component looks like this:
                </p>
                <pre><code class="javascript">
    // declare our component
    class myGeneratedList extends nort.Component {
        constructor( attributes, items ) {
            super(attributes)
            let me = this   // We make a copy of "this" to make sure we can us it in callbacks
            this.items = items
            // Add a textbox and a button
            this.textbox = $input({ type: "text" })
            this.button  = $input({ type: "button", value:"Add to list"  })
            
            // Add a callback to the button
            this.button.onclick = function() {
                // Note we use "me" and not "this"
                me.addItem( me.textbox.value)
            }
        }
        
        // Modify the component's data and refresh it.
        addItem(item) {
            this.items.push(item)
            this.refresh()
        }
        

        render() {
            let list=[]
            // Generate an array of LI elements.
            for ( let item of this.items ) {
                list.push( $li(this.properties, item ))
            }
            
            // Return a UL element containing the collection of LI element.
            return $div({}, 
                $ul({}, list),
                this.textbox, this.button )
        }
    }
                
                </code></pre>         
                <h2>Component events</h2>
                <p>The modular structure of NORT's component model makes it very easy to create components out of other components. 
                    for example, you may want to create a form that includes a table with data. The form is a component, and 
                    NORT has a great component to display data in a table, the grid. You then build a form containing fiels, buttons, a grid.
                     he question then is: if something happens in the table (like the user selecting a row), how can the form be made 
                     aware of the row selection change ? The answer is simple: Component events.
                </p>
                <p>Component events are a very flexible way of communicating from a child component to its parent. To set up
                    events in your architecture all you need to do is the following: </p>
                
                <ol>
                    <li>Define how you want the event to named. The name, of course has to be a string. For example we will 
                        name our event "row-selection"</li>
                    <li>In the child component, right where your code needs to add a call to the component method fireEvent(). 
                        This method is part of the Component class, you don't need to create it.</li>
                    <li>In the parent component, define how to respond to the event by creating an event handler and attaching it 
                        using the Component.on() method.
                    </li>
                </ol>
                <p>Sounds complicated ? Let's look at the code !</p>
                <p>In the child component, fire the event.</p>
                <pre><code class="javascript">
    // Place this code where a row selection occurs.
    this.fireEvent("row-selection", { row: rownum, state: rows[rownum].isSelected } )
                </code></pre>
                <p>In the parent component, react to it.</p>
                <pre><code class="javascript">
    // Attach event handler
    myGrid.on("row-selection", function(source, eventData){
        // write what to do with teh eventData here.
        // Source indicates the components that fired the event.
    })
                </code></pre>           
                <p>The name of the event and the format of the eventData is completely free. Just define what is appropriate for 
                    your use case. </p>     

                <div class="docnav-panel">
                    <a class="green-button" href="tutorial3.html">Back</a>
                    <a class="green-button" href="tutorial.html">Contents</a>
                    <a class="green-button" href="tutorial5.html">Next</a>
                </div>
            </div>
        </div>
    </section>
    <script>include("footer.html")</script>  
    <script>insertToc("toc", "contents", "h2")</script>      
</body>
</html>